!function(){"use strict";let e={id:"appointments",display:"block",events:function(e,t,r){ResourceCalendarController.getAppointments(e.start.getTime(),e.end.getTime(),((e,s)=>{s.status?t(e):r(s)}),{escape:!1})},failure:function(e){S.showAlert(e.type,e.message)},eventDataTransform:function(e){if(S.selectedResources.length>0){if(!e.ServiceResources)return!1;if(0===e.ServiceResources.filter((e=>S.selectedResources.includes(e.Id))).length)return!1}if(S.selectedStatuses.length>0){if(!e.StatusCategory)return!1;if(!S.selectedStatuses.includes(e.StatusCategory))return!1}if(S.selectedWorkTypes.length>0){if(!e.WorkTypeName)return!1;if(!S.selectedWorkTypes.includes(e.WorkTypeName))return!1}if(S.ownerId){if(!e.OwnerId)return!1;if(S.ownerId!==e.OwnerId)return!1}return!(S.searchValue&&!e.Label?.toLowerCase().includes(S.searchValue.toLowerCase()))&&new c(e)}},t={id:"absenses",color:"#999999",display:"block",events:function(e,t,r){0!==S.selectedResources.length?ResourceCalendarController.getAbsences(e.start.getTime(),e.end.getTime(),S.selectedResources,((e,s)=>{s.status?t(e):r(s)})):t([])},failure:function(e){S.showAlert(e.type,e.message)},eventDataTransform:function(e){return new d(e)}},r={id:"holidays",color:"pink",display:"block",textColor:"black",events:function(e,t,r){ResourceCalendarController.getHolidays(e.start.getTime(),e.end.getTime(),((e,s)=>{s.status?t(e):r(s)}))},success:function(e){return Object.keys(e).map((t=>({id:e[t].Id,start:parseInt(t)+h(t),title:u(e[t].Name),allDay:e[t].IsAllDay})))},failure:function(e){S.showAlert(e.type,e.message)}};const s="vf.resourceCalendar.selectedOwner",n="vf.resourceCalendar.selectedResources",o="vf.resourceCalendar.selectedStatuses",a="vf.resourceCalendar.selectedWorkTypes",i=document.getElementById("calendar"),l={allDaySlot:!0,buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},customButtons:{exportToCsv:{text:"Export",click:function(){let e=v.getEvents().filter((e=>"appointments"===e.source.id)).reduce(((e,t)=>{let r=Object.fromEntries(Object.entries(t.extendedProps).filter((function([,e]){return"string"==typeof e||"number"==typeof e})));for(let[e,t]of Object.entries(r))e.includes("Time")&&(r[e]=new Date(t).toISOString());return e.push(r),e}),[]);ResourceCalendarController.exportToCsv(JSON.stringify(e),((e,t)=>{if(t.status){let t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURIComponent(e),t.target="_blank",t.download="ServiceAppointment_Export.csv",t.click(),t.remove()}else S.showAlert(t.type,t.message)}),{escape:!1})}}},dayMaxEventRows:!0,dayPopoverFormat:{day:"numeric",month:"long",weekday:"long"},defaultTimedEventDuration:"00:30:00",editable:!1,eventClick:function(e){let t=e.event.extendedProps;if(!t||!t.Id)return;let r=document.createElement("a");r.href=`/${t.Id}`,r.target="_blank",r.click(),r.remove()},eventDidMount:function(e){let t=e.event.extendedProps;if(!t||!t.tooltip)return;let r={title:t.tooltip,placement:"top",trigger:"hover",container:"body",html:!0,sanitize:!1,delay:{show:500,hide:100}};$(e.el).tooltip(r)},eventSources:[e,t,r],forceEventDuration:!0,handleWindowResize:!0,headerToolbar:{left:"prev,next today exportToCsv",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},height:"100%",initialDate:new Date,initialView:"dayGridMonth",loading:e=>!e&&$("#spinner").fadeOut(),moreLinkClick:"popover",navLinks:!0,nowIndicator:!0,selectable:!1,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",themeSystem:"bootstrap",viewDidMount:function(){let e=document.getElementById("worktype-selector");i.querySelector(".fc-header-toolbar .fc-toolbar-chunk:first-of-type").appendChild(e);let t=document.getElementById("search-bar");i.querySelector(".fc-header-toolbar .fc-toolbar-chunk:last-of-type .btn-group").prepend(t)},weekNumbers:!1};function c(e){this.id=e.Id,this.start=e.SchedStartTime||e.ArrivalWindowStartTime,this.end=e.SchedEndTime||e.ArrivalWindowEndTime,this.color=m(e.StatusCategory),this.title=u(e.Label),this.extendedProps=Object.assign(this.extendedProps||{},e),this.tooltip=f({Number:e.AppointmentNumber,Status:e.Status,"Work Type":e.WorkTypeName,Account:e.AccountName,Address:[e.Street,e.City,e.State,e.PostalCode,e.Country].filter((e=>e)).join(", "),Start:p(e.SchedStartTime||e.ArrivalWindowStartTime),End:p(e.SchedEndTime||e.ArrivalWindowEndTime)})+function(){let t="";if(!e.ServiceResources||e.ServiceResources.length<=0)return t;return e.ServiceResources.forEach((e=>{t+=`${e.Name} - ${e.Label}<br>`})),t}()}function d(e){this.id=e.Id,this.start=e.StartTime,this.end=e.EndTime,this.title=u(e.Label),this.extendedProps=Object.assign(this.extendedProps||{},e),this.tooltip=f({Number:e.AbsenceNumber,Type:e.Type,Resource:`${e.Resource.Name} - ${e.Resource.Label}`,Start:p(e.StartTime),End:p(e.EndTime)})}function u(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}function f(e){let t="<table>";for(let[r,s]of Object.entries(e))r&&s&&(t+="<tr>",t+=`<th>${r}</th>`,t+=`<td>${s}</td>`,t+="</tr>");return t+="</table>",t}function h(e){return 6e4*(e?new Date(parseInt(e)):new Date).getTimezoneOffset()}function p(e,t){return e?(t||(t="ddd MMM D YYYY h:mm A"),dayjs(parseInt(e)).format(t)):""}function m(e){switch(e){case"None":return"#003f5c";case"Scheduled":return"#58508d";case"Dispatched":return"#ff832b";case"In Progress":return"#f1c21b";case"Cannot Complete":return"#da1e28";case"Completed":return"#198038";case"Canceled":return"#000000"}}function y(e){try{if(null!==localStorage)return JSON.parse(localStorage.getItem(e));if(null!==sessionStorage)return JSON.parse(sessionStorage.getItem(e))}catch(e){}}function g(e,t){try{t=JSON.stringify(t),null!==localStorage?localStorage.setItem(e,t):null!==sessionStorage&&sessionStorage.setItem(e,t)}catch(e){}}let S=new function(){const e=this;this.alertOpen=!1,this.alertTitle="",this.alertMessage="",this.ownerId=y(s)||"",this.resources=[],this.selectedResources=y(n)||[],this.selectedStatuses=y(o)||[],this.selectedWorkTypes=y(a)||[],this.statuses=[],this.workTypes=[],this.searchValue="",this.onResourceClick=function(t,r){let s=e.resources.find((e=>e.Id===r)),o=e.selectedResources.indexOf(s.Id);-1!=o?e.selectedResources.splice(o,1):e.selectedResources.push(s.Id),v.refetchEvents(),T.update(e),g(n,e.selectedResources)},this.onStatusClick=function(t,r){let s=e.selectedStatuses.indexOf(r);-1!=s?e.selectedStatuses.splice(s,1):e.selectedStatuses.push(r),v.refetchEvents(),T.update(e),g(o,e.selectedStatuses)},this.onWorkTypeClick=function(t,r){let s=e.selectedWorkTypes.indexOf(r);"All"===r?e.selectedWorkTypes=[]:-1!=s?e.selectedWorkTypes.splice(s,1):e.selectedWorkTypes.push(r),v.refetchEvents(),T.update(e),g(a,e.selectedWorkTypes)},this.showAll=function(){e.selectedResources=[],e.ownerId="",v.refetchEvents(),T.update(e),g(s,e.ownerId),g(n,e.selectedResources)},this.showMine=function(){e.ownerId?e.ownerId="":e.ownerId=userId,v.refetchEvents(),T.update(e),g(s,e.ownerId)},this.showAlert=function(t,r){e.alertTitle=t,e.alertMessage=r,e.alertOpen=!0,T.update(e)},this.closeAlert=function(){e.alertOpen=!1,e.alertTitle="",e.alertMessage="",T.update(e)},this.onSearch=function(){v.refetchEvents()},ResourceCalendarController.getResources(((t,r)=>{r.status?e.resources=t:e.showAlert(r.type,r.message)})),ResourceCalendarController.getStatuses(((t,r)=>{r.status?e.statuses=t:e.showAlert(r.type,r.message)})),ResourceCalendarController.getWorkTypes(((t,r)=>{r.status?e.workTypes=t:e.showAlert(r.type,r.message)}))};const v=new FullCalendar.Calendar(i,l);v.render(),rivets.formatters.formatDate=function(e,t){return p(e,t)},rivets.formatters.getColor=function(e){return m(e)},rivets.binders.keyupdelay.callback=S.onSearch;let T=rivets.bind(document.body,S);setInterval((()=>{v.refetchEvents()}),3e5),$(document).on("click",(()=>{$(".tooltip").tooltip("hide")}))}();