(function(){"use strict";function e(e){function t(){let t="";return!e.ServiceResources||e.ServiceResources.length<=0?t:(e.ServiceResources.forEach(e=>{t+=`${e.ServiceResource.Name} - ${e.ServiceResource.FSL__GanttLabel__c}<br>`}),t)}function r(){return e.SchedStartTime?`Scheduled Start: ${c(e.SchedStartTime)}<br>`+`Scheduled End: ${c(e.SchedEndTime)}`:e.ArrivalWindowStartTime?`Arrival Start: ${c(e.ArrivalWindowStartTime)}<br>`+`Arrival End: ${c(e.ArrivalWindowEndTime)}`:""}this.id=e.Id,this.start=e.SchedStartTime||e.ArrivalWindowStartTime,this.end=e.SchedEndTime||e.ArrivalWindowEndTime,this.color=d(e.Status),this.title=a(e.FSL__GanttLabel__c||e.AppointmentNumber),this.extendedProps=Object.assign(this.extendedProps||{},e),this.tooltip=`<b>${e.AppointmentNumber} / ${e.FSL__GanttLabel__c||""}</b> (${e.Status})<br>`+`${t()}`+`${e.Street} ${e.City}, ${e.State} ${e.PostalCode}<br>`+`${r()}`}function t(e){this.id=e.Id,this.start=e.Start,this.end=e.End,this.title=e.FSL__GanttLabel__c,this.extendedProps=Object.assign(this.extendedProps||{},e),this.tooltip=`<b>${e.AbsenceNumber} / ${e.FSL__GanttLabel__c}</b> (${e.Type})<br>`+`Resource: ${e.Resource.Name}<br>`+`Start: ${c(e.Start)}<br>`+`End: ${c(e.End)}`}function r(e,t){let r=document.getElementById("type-select");T.querySelector(".fc-header-toolbar .fc-toolbar-chunk:first-of-type").appendChild(r)}function s(e){let t=e.event.extendedProps;if(!t||!t.tooltip)return;let r={title:t.tooltip,placement:"top",trigger:"hover",container:"body",html:!0,delay:{show:500,hide:100}};$(e.el).tooltip(r)}function n(e){let t=e.event.extendedProps;if(!t||!t.Id)return;let r=document.createElement("a");r.href=`/${t.Id}`,r.target="_blank",r.click(),r.remove()}function o(){let e=v.getEvents().filter(e=>"appointments"===e.source.id).reduce((e,t)=>{let r=Object.fromEntries(Object.entries(t.extendedProps).filter(([e,t])=>"string"==typeof t||"number"==typeof t));return e.push(r),e},[]);ResourceCalendarController.exportToCsv(JSON.stringify(e),(e,t)=>{if(t.status){let t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURI(e),t.target="_blank",t.download="ServiceAppointment_Export.csv",t.click(),t.remove()}else y.showAlert(t.type,t.message)})}function i(){const e=this;this.alertOpen=!1,this.alertTitle="",this.alertMessage="",this.resources=[],this.selectedResource=u(S.SELECTED_RESOURCE)||[],this.selectedStatus=u(S.SELECTED_STATUS)||[],this.selectedType=u(S.SELECTED_TYPE)||[],this.statuses=[],this.workTypes=[],this.onResourceClick=function(t,r){let s=e.resources.find(e=>e.Id===r),n=e.selectedResource.indexOf(s.Id);-1!=n?e.selectedResource.splice(n,1):e.selectedResource.push(s.Id),v.refetchEvents(),g.update(e),p(S.SELECTED_RESOURCE,e.selectedResource)},this.onStatusClick=function(t,r){let s=e.selectedStatus.indexOf(r);-1!=s?e.selectedStatus.splice(s,1):e.selectedStatus.push(r),v.refetchEvents(),g.update(e),p(S.SELECTED_STATUS,e.selectedStatus)},this.onTypeClick=function(t,r){let s=e.selectedType.indexOf(r);"All"===r?e.selectedType=[]:-1!=s?e.selectedType.splice(s,1):e.selectedType.push(r),v.refetchEvents(),g.update(e),p(S.SELECTED_TYPE,e.selectedType)},this.showAll=function(){e.selectedResource=[],v.refetchEvents(),g.update(e),p(S.SELECTED_RESOURCE,e.selectedResource)},this.showAlert=function(t,r){e.alertTitle=t,e.alertMessage=r,e.alertOpen=!0,g.update(e)},this.closeAlert=function(){e.alertOpen=!1,e.alertTitle="",e.alertMessage="",g.update(e)},ResourceCalendarController.getResources((t,r)=>{r.status?e.resources=t:e.showAlert(r.type,r.message)}),ResourceCalendarController.getStatuses((t,r)=>{r.status?e.statuses=t:e.showAlert(r.type,r.message)})}function a(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}function l(e){let t=e?new Date(parseInt(e)):new Date;return 6e4*t.getTimezoneOffset()}function c(e,t){return e?(t||(t="ddd MMM D YYYY h:mm A"),dayjs(parseInt(e)).format(t)):""}function d(e){switch(e){case"None":return"#003f5c";case"Scheduled":return"#58508d";case"Dispatched":return"#ff832b";case"In Progress":return"#f1c21b";case"Cannot Complete":return"#da1e28";case"Completed":return"#198038";case"Canceled":return"#000000"}}function u(e){try{if(null!==localStorage)return JSON.parse(localStorage.getItem(e));if(null!==sessionStorage)return JSON.parse(sessionStorage.getItem(e))}catch(e){}}function p(e,t){try{t=JSON.stringify(t),null!==localStorage?localStorage.setItem(e,t):null!==sessionStorage&&sessionStorage.setItem(e,t)}catch(e){}}let h={id:"appointments",display:"block",events:function(e,t,r){ResourceCalendarController.getAppointments(e.start.getTime(),e.end.getTime(),(e,s)=>{s.status?t(e):r(s)})},success:function(e){y.workTypes=e.reduce((e,t)=>(t.WorkType&&-1==e.indexOf(t.WorkType.Name)&&e.push(t.WorkType.Name),e),[])},failure:function(e){y.showAlert(e.type,e.message)},eventDataTransform:function(t){if(y.selectedResource.length>0&&t.ServiceResources){let e=t.ServiceResources.filter(e=>y.selectedResource.includes(e.ServiceResourceId));if(0===e.length)return!1}return!(y.selectedStatus.length>0&&!y.selectedStatus.includes(t.Status))&&(!(t.WorkType&&y.selectedType.length>0&&!y.selectedType.includes(t.WorkType.Name))&&new e(t))}},f={id:"absenses",color:"#999999",display:"block",events:function(e,t,r){0!==y.selectedResource.length?ResourceCalendarController.getAbsences(e.start.getTime(),e.end.getTime(),y.selectedResource,(e,s)=>{s.status?t(e):r(s)}):t([])},failure:function(e){y.showAlert(e.type,e.message)},eventDataTransform:function(e){return new t(e)}},m={id:"holidays",color:"pink",display:"block",textColor:"black",events:function(e,t,r){ResourceCalendarController.getHolidays(e.start.getTime(),e.end.getTime(),(e,s)=>{s.status?t(e):r(s)})},success:function(e){return Object.keys(e).map(t=>({id:e[t].Id,start:parseInt(t)+l(t),title:a(e[t].Name),allDay:e[t].IsAllDay}))},failure:function(e){y.showAlert(e.type,e.message)}};const S={SELECTED_RESOURCE:"vf.resourceCalendar.selectedResource",SELECTED_STATUS:"vf.resourceCalendar.selectedStatus",SELECTED_TYPE:"vf.resourceCalendar.selectedType"},T=document.getElementById("calendar"),E={allDaySlot:!0,buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},customButtons:{exportToCsv:{text:"Export",click:o}},dayMaxEventRows:!0,dayPopoverFormat:{day:"numeric",month:"long",weekday:"long"},defaultTimedEventDuration:"00:30:00",editable:!1,eventClick:n,eventDidMount:s,eventSources:[h,f,m],forceEventDuration:!0,handleWindowResize:!0,headerToolbar:{left:"prev,next today exportToCsv",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},height:"100%",initialDate:new Date,initialView:"dayGridMonth",loading:e=>!e&&$("#spinner").fadeOut(),moreLinkClick:"popover",navLinks:!0,nowIndicator:!0,selectable:!1,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",themeSystem:"bootstrap",viewDidMount:r,weekNumbers:!1};rivets.formatters.formatDate=function(e,t){return c(e,t)},rivets.formatters.getColor=function(e){return d(e)};let y=new i,g=rivets.bind(document.body,y);const v=new FullCalendar.Calendar(T,E);v.render(),setInterval(()=>{v.refetchEvents()},3e5),$(document).on("click",()=>{$(".tooltip").tooltip("hide")})})();