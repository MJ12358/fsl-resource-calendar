!function(){"use strict";let e={id:"appointments",display:"block",events:function(e,t,r){ResourceCalendarController.getAppointments(e.start.getTime(),e.end.getTime(),((e,s)=>{s.status?t(e):r(s)}))},success:function(e){S.workTypes=e.sort(((e,t)=>e.WorkType?e.WorkType.Name>t.WorkType.Name?1:-1:0)).reduce(((e,t)=>(t.WorkType&&-1==e.indexOf(t.WorkType.Name)&&e.push(t.WorkType.Name),e)),[])},failure:function(e){S.showAlert(e.type,e.message)},eventDataTransform:function(e){if(S.selectedResources.length>0){if(!e.ServiceResources)return!1;if(0===e.ServiceResources.filter((e=>S.selectedResources.includes(e.ServiceResourceId))).length)return!1}if(S.selectedStatuses.length>0){if(!e.Status)return!1;if(!S.selectedStatuses.includes(e.Status))return!1}if(S.selectedWorkTypes.length>0){if(!e.WorkType)return!1;if(!S.selectedWorkTypes.includes(e.WorkType.Name))return!1}if(S.ownerId){if(!e.OwnerId)return!1;if(S.ownerId!==e.OwnerId)return!1}return!(S.searchValue&&!e.Account?.Name.toLowerCase().includes(S.searchValue))&&new l(e)}},t={id:"absenses",color:"#999999",display:"block",events:function(e,t,r){0!==S.selectedResources.length?ResourceCalendarController.getAbsences(e.start.getTime(),e.end.getTime(),S.selectedResources,((e,s)=>{s.status?t(e):r(s)})):t([])},failure:function(e){S.showAlert(e.type,e.message)},eventDataTransform:function(e){return new d(e)}},r={id:"holidays",color:"pink",display:"block",textColor:"black",events:function(e,t,r){ResourceCalendarController.getHolidays(e.start.getTime(),e.end.getTime(),((e,s)=>{s.status?t(e):r(s)}))},success:function(e){return Object.keys(e).map((t=>({id:e[t].Id,start:parseInt(t)+f(t),title:u(e[t].Name),allDay:e[t].IsAllDay})))},failure:function(e){S.showAlert(e.type,e.message)}};const s="vf.resourceCalendar.selectedOwner",n="vf.resourceCalendar.selectedResources",o="vf.resourceCalendar.selectedStatuses",a="vf.resourceCalendar.selectedWorkTypes",i=document.getElementById("calendar"),c={allDaySlot:!0,buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},customButtons:{exportToCsv:{text:"Export",click:function(){let e=b.getEvents().filter((e=>"appointments"===e.source.id)).reduce(((e,t)=>{let r=Object.fromEntries(Object.entries(t.extendedProps).filter((([e,t])=>"string"==typeof t||"number"==typeof t)));return e.push(r),e}),[]);ResourceCalendarController.exportToCsv(JSON.stringify(e),((e,t)=>{if(t.status){let t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURI(e),t.target="_blank",t.download="ServiceAppointment_Export.csv",t.click(),t.remove()}else S.showAlert(t.type,t.message)}))}}},dayMaxEventRows:!0,dayPopoverFormat:{day:"numeric",month:"long",weekday:"long"},defaultTimedEventDuration:"00:30:00",editable:!1,eventClick:function(e){let t=e.event.extendedProps;if(!t||!t.Id)return;let r=document.createElement("a");r.href=`/${t.Id}`,r.target="_blank",r.click(),r.remove()},eventDidMount:function(e){let t=e.event.extendedProps;if(!t||!t.tooltip)return;let r={title:t.tooltip,placement:"top",trigger:"hover",container:"body",html:!0,delay:{show:500,hide:100}};$(e.el).tooltip(r)},eventSources:[e,t,r],forceEventDuration:!0,handleWindowResize:!0,headerToolbar:{left:"prev,next today exportToCsv",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},height:"100%",initialDate:new Date,initialView:"dayGridMonth",loading:e=>!e&&$("#spinner").fadeOut(),moreLinkClick:"popover",navLinks:!0,nowIndicator:!0,selectable:!1,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",themeSystem:"bootstrap",viewDidMount:function(e,t){let r=document.getElementById("worktype-selector");i.querySelector(".fc-header-toolbar .fc-toolbar-chunk:first-of-type").appendChild(r);let s=document.getElementById("search-bar");i.querySelector(".fc-header-toolbar .fc-toolbar-chunk:last-of-type .btn-group").prepend(s)},weekNumbers:!1};function l(e){function t(){return e.FSL__GanttLabel__c||e.Account?.Name||e.AppointmentNumber}this.id=e.Id,this.start=e.SchedStartTime||e.ArrivalWindowStartTime,this.end=e.SchedEndTime||e.ArrivalWindowEndTime,this.color=p(e.Status),this.title=u(t()),this.extendedProps=Object.assign(this.extendedProps||{},e),this.tooltip=`<b>${e.AppointmentNumber} / ${t()}</b> (${e.Status})<br>${e.WorkType?.Name}<br>${function(){let t="";if(!e.ServiceResources||e.ServiceResources.length<=0)return t;return e.ServiceResources.forEach((e=>{t+=`${e.ServiceResource.Name} - ${e.ServiceResource.FSL__GanttLabel__c}<br>`})),t}()}${e.Street} ${e.City}, ${e.State} ${e.PostalCode}<br>${function(){if(e.SchedStartTime)return`<b>Scheduled Start:</b> ${h(e.SchedStartTime)}<br><b>Scheduled End:</b> ${h(e.SchedEndTime)}`;if(e.ArrivalWindowStartTime)return`<b>Arrival Start:</b> ${h(e.ArrivalWindowStartTime)}<br><b>Arrival End:</b> ${h(e.ArrivalWindowEndTime)}`;return""}()}`}function d(e){this.id=e.Id,this.start=e.Start,this.end=e.End,this.title=e.FSL__GanttLabel__c,this.extendedProps=Object.assign(this.extendedProps||{},e),this.tooltip=`<b>${e.AbsenceNumber} / ${e.FSL__GanttLabel__c}</b> (${e.Type})<br><b>Start:</b> ${h(e.Start)}<br><b>End:</b> ${h(e.End)}`}function u(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}function f(e){return 6e4*(e?new Date(parseInt(e)):new Date).getTimezoneOffset()}function h(e,t){return e?(t||(t="ddd MMM D YYYY h:mm A"),dayjs(parseInt(e)).format(t)):""}function p(e){switch(e){case"None":return"#003f5c";case"Scheduled":return"#58508d";case"Dispatched":return"#ff832b";case"In Progress":return"#f1c21b";case"Cannot Complete":return"#da1e28";case"Completed":return"#198038";case"Canceled":return"#000000"}}function m(e){try{if(null!==localStorage)return JSON.parse(localStorage.getItem(e));if(null!==sessionStorage)return JSON.parse(sessionStorage.getItem(e))}catch(e){}}function y(e,t){try{t=JSON.stringify(t),null!==localStorage?localStorage.setItem(e,t):null!==sessionStorage&&sessionStorage.setItem(e,t)}catch(e){}}let S=new function(){const e=this;this.alertOpen=!1,this.alertTitle="",this.alertMessage="",this.ownerId=m(s)||"",this.resources=[],this.selectedResources=m(n)||[],this.selectedStatuses=m(o)||[],this.selectedWorkTypes=m(a)||[],this.statuses=[],this.workTypes=[],this.searchValue="",this.onResourceClick=function(t,r){let s=e.resources.find((e=>e.Id===r)),o=e.selectedResources.indexOf(s.Id);-1!=o?e.selectedResources.splice(o,1):e.selectedResources.push(s.Id),b.refetchEvents(),v.update(e),y(n,e.selectedResources)},this.onStatusClick=function(t,r){let s=e.selectedStatuses.indexOf(r);-1!=s?e.selectedStatuses.splice(s,1):e.selectedStatuses.push(r),b.refetchEvents(),v.update(e),y(o,e.selectedStatuses)},this.onWorkTypeClick=function(t,r){let s=e.selectedWorkTypes.indexOf(r);"All"===r?e.selectedWorkTypes=[]:-1!=s?e.selectedWorkTypes.splice(s,1):e.selectedWorkTypes.push(r),b.refetchEvents(),v.update(e),y(a,e.selectedWorkTypes)},this.showAll=function(){e.selectedResources=[],e.ownerId="",b.refetchEvents(),v.update(e),y(n,e.selectedResources)},this.showMine=function(){e.ownerId?e.ownerId="":e.ownerId=userId,b.refetchEvents(),v.update(e),y(s,e.ownerId)},this.showAlert=function(t,r){e.alertTitle=t,e.alertMessage=r,e.alertOpen=!0,v.update(e)},this.closeAlert=function(){e.alertOpen=!1,e.alertTitle="",e.alertMessage="",v.update(e)},this.onSearch=function(){e.searchValue=e.searchValue.toLowerCase(),b.refetchEvents(),v.update(e)},ResourceCalendarController.getResources(((t,r)=>{r.status?e.resources=t:e.showAlert(r.type,r.message)})),ResourceCalendarController.getStatuses(((t,r)=>{r.status?e.statuses=t:e.showAlert(r.type,r.message)}))};const b=new FullCalendar.Calendar(i,c);b.render(),rivets.formatters.formatDate=function(e,t){return h(e,t)},rivets.formatters.getColor=function(e){return p(e)},rivets.binders.keyupdelay.callback=S.onSearch;let v=rivets.bind(document.body,S);setInterval((()=>{b.refetchEvents()}),3e5),$(document).on("click",(()=>{$(".tooltip").tooltip("hide")}))}();